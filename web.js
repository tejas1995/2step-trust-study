(()=>{"use strict";var t={d:(i,o)=>{for(var n in o)t.o(o,n)&&!t.o(i,n)&&Object.defineProperty(i,n,{enumerable:!0,get:o[n]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i)};t.d({},{o:()=>o});let i="https://tejassrinivasan.pythonanywhere.com/";var o=!1,n=[];let e,a,s,r,c=-1,_=null,l=-1,d=-1,u=0,p=1,b=0,h=0;function g(t,i){if(!t)throw i||"Assertion failed"}function v(t){b+=t,0==b?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),b>=6?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),7==b&&($("#main_box_instructions").hide(),$("#main_box_experiment").show(),w()),$("#main_box_instructions").children(":not(input)").each(((t,i)=>{$(i).hide()})),$(`#instructions_${b}`).show()}function f(t){s=Date.now(),l=t,g(1==t||2==t,"Invalid option!"),1==t?($("#button_initial_decision_option1").attr("activedecision","true"),$("#button_initial_decision_option2").removeAttr("activedecision")):($("#button_initial_decision_option1").removeAttr("activedecision"),$("#button_initial_decision_option2").attr("activedecision","true")),$("#ai_assistance_div").show(),$("#final_user_decision_div").show(),$("#button_initial_decision_option1").attr("disabled","true"),$("#button_initial_decision_option2").attr("disabled","true"),$("#button_final_decision_option1").removeAttr("disabled"),$("#button_final_decision_option2").removeAttr("disabled")}function m(t){r=Date.now(),d=t,g(1==t||2==t,"Invalid option!"),1==t?($("#button_final_decision_option1").attr("activedecision","true"),$("#button_final_decision_option2").removeAttr("activedecision")):($("#button_final_decision_option1").removeAttr("activedecision"),$("#button_final_decision_option2").attr("activedecision","true")),$("#button_final_decision_option1").attr("disabled","true"),$("#button_final_decision_option2").attr("disabled","true"),function(){let t=_.correct_option,i=t==d,o=_.ai_is_correct,n="Correct answer: <b>Option "+t+"</b>.<br>";n+=i?"You picked Option "+d+", which was <span class='color_correct'><b>correct</b></span>.<br>":"You picked Option "+d+", which was <span class='color_incorrect'><b>incorrect</b></span>.<br>",n+=o?"The AI picked Option "+t+", which was <span class='color_correct'><b>correct<b></span>.<br>":"The AI picked Option "+t+", which was <span class='color_incorrect'><b>incorrect</b></span>.<br>",i?(n+="<span class='color_correct'><b>You receive a reward of $0.1.</b></span>",u+=.1):n+="<span class='color_incorrect'><b>You do not receive any reward.</b></span>",n+="<br>",$("#balance").text(`Balance: $${u.toFixed(2)} + $1.0`),$("#result_span").html(n),$("#result_span").show(),$("#how_confident_div").show()}()}function w(){if($("#button_initial_decision_option1").removeAttr("activedecision"),$("#button_initial_decision_option2").removeAttr("activedecision"),$("#button_initial_decision_option1").removeAttr("disabled"),$("#button_initial_decision_option2").removeAttr("disabled"),$("#button_final_decision_option1").removeAttr("activedecision"),$("#button_final_decision_option2").removeAttr("activedecision"),$("#button_final_decision_option1").removeAttr("disabled"),$("#button_final_decision_option2").removeAttr("disabled"),$("#ai_assistance_div").hide(),$("#final_user_decision_div").hide(),$("#range_val").removeAttr("disabled"),$("#how_confident_div").hide(),$("#button_place_bet").hide(),$("#button_next").hide(),$("#result_span").hide(),-1==c?$("#range_text").text("-"):$("#range_text").text(`Before this interaction, your trust in the AI: ${10*e} / 100.`),$("#range_val").val(e),c+=1,c>=n.length)return $("#main_box_experiment").hide(),void(o?$("#main_box_end_mock").show():$("#main_box_end").show());if(_=n[c],$("#question_span").html(_.question),$("#option1_span").html(_.option1),$("#option2_span").html(_.option2),$("#ai_prediction_span").html("Option "+_.ai_prediction),$("#ai_confidence_span").html(_.ai_confidence),_.hasOwnProperty("reward_ratio")){let[t,i]=_.reward_ratio;t=Number(t),i=Number(i),p=t/i}else p=1;a=Date.now(),$("#progress").text(`Progress: ${c+1} / ${n.length}`)}$("#button_instructions_next").on("click",(()=>v(1))),$("#button_instructions_prev").on("click",(()=>v(-1))),$("#button_next").on("click",(()=>{if(-1!=c){let t={question_i:c,user_balance_post_interaction:u,user_trust_val:e,initial_user_decision:l,final_user_decision:d};t.times={initial_decision:s-a,final_decision:r-s,user_trust:Date.now()-r},t.question=_,t.count_exited_page=h,async function(t){if(o)console.log("logged (mock)",t);else{t.url_data=globalThis.url_data,console.log("Data"),"study_id"in t.url_data||(t.url_data.study_id="trialrun_studies"),t.url_data.queue_id=globalThis.uid,console.log("logged",t),console.log("Logging to",i+"log");try{return await $.ajax(i+"log",{data:JSON.stringify({project:"2step-trust-study/"+t.url_data.study_id,uid:globalThis.uid,payload:JSON.stringify(t)}),type:"POST",contentType:"application/json"})}catch(t){console.log(t)}}}(t),h=0}w()})),$("#range_val").on("input change",(function(){e=$(this).val(),$("#range_text").text(`After this interaction, your current trust in the AI: ${10*e} / 100.`),$("#button_next").show()})),$("#button_initial_decision_option1").on("click",(()=>f(1))),$("#button_initial_decision_option2").on("click",(()=>f(2))),$("#button_final_decision_option1").on("click",(()=>m(1))),$("#button_final_decision_option2").on("click",(()=>m(2)));const y=new URLSearchParams(window.location.search),x=y.get("start"),A=y.get("uid");if(globalThis.url_data=function(t){const i={};for(const[o,n]of t)i[o]=n;return i}(y.entries()),null!=A){if(globalThis.uid=A,"prolific_random"==globalThis.uid){let t=`${Math.floor(10*Math.random())}`.padStart(3,"0");globalThis.uid=`${y.get("prolific_queue_name")}_${t}`}}else{let t=null;for(;null==t;)t=prompt("Enter your user id. Please get in touch if you were not assigned an id but wish to participate in this experiment.");globalThis.uid=t}globalThis.uid.startsWith("demo_paper")&&(o=!0),console.log("Running with UID",globalThis.uid),async function(){return await $.getJSON(`baked_queues/${globalThis.uid}.json?t=${Date.now()}`)}().catch((t=>{console.log("Invalid user id."),console.log(globalThis.uid),window.location.reload()})).then((t=>{n=t,null!=x&&(c=parseInt(x)-1,console.log("Starting from",c)),v(0),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with UID:",globalThis.uid);let T=!1;document.onvisibilitychange=()=>{T||(h+=1,T=!0,alert("Please don't leave the page. If you do so again, we may restrict paying you."),T=!1)}})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUlLLEVBQWlCLEtBQ3JCLEtBQW9CLE1BQWJBLEdBQ0hBLEVBQVlDLE9BQU8sc0hBRXZCOUIsV0FBV0UsSUFBTTJCLEMsQ0FJakI3QixXQUFXRSxJQUFJNkIsV0FBVyxnQkFDMUJsRixHQUFXLEdBSWZpRCxRQUFRQyxJQUFJLG1CQUFvQkMsV0FBV0UsS0RyUXBDTCxpQkFLSCxhQUhtQjdCLEVBQUVnRSxRQUNqQixnQkFBZ0JoQyxXQUFXRSxjQUFjckIsS0FBS0MsUUFHdEQsQ0NnUUFtRCxHQUFZQyxPQUFPQyxJQUVmckMsUUFBUUMsSUFBSSxvQkFDWkQsUUFBUUMsSUFBSUMsV0FBV0UsS0FDdkJhLE9BQU9DLFNBQVNvQixRQUFRLElBRTFCQyxNQUFNQyxJQUNKeEYsRUFBT3dGLEVBQ2MsTUFBakJwQixJQUNBL0QsRUFBYW9GLFNBQVNyQixHQUFpQixFQUN2Q3BCLFFBQVFDLElBQUksZ0JBQWlCNUMsSUFHakNXLEVBQWtCLEdBQ2xCRSxFQUFFLDBCQUEwQkcsT0FDNUJILEVBQUUsaUNBQWlDSyxNQUFNLElBRzdDeUIsUUFBUUMsSUFBSSw2QkFBOEJDLFdBQVdFLEtBRXJELElBQUlzQyxHQUFlLEVBQ25CQyxTQUFTQyxtQkFBcUIsS0FDckJGLElBQ0Q5RSxHQUFxQixFQUNyQjhFLEdBQWUsRUFDZkcsTUFBTSxnRkFDTkgsR0FBZSxFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovLy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Nvbm5lY3Rvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJpbXBvcnQgeyBERVZNT0RFIH0gZnJvbSAnLi9nbG9iYWxzJ1xuaW1wb3J0IHsgTU9DS01PREUgfSBmcm9tICcuL21haW4nXG5cbmxldCBTRVJWRVJfTE9HX1JPT1QgPSBERVZNT0RFID8gXCJodHRwOi8vMTI3LjAuMC4xOjUwMDAvXCIgOiBcImh0dHBzOi8vdGVqYXNzcmluaXZhc2FuLnB5dGhvbmFueXdoZXJlLmNvbS9cIlxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZF9kYXRhKCk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gaW5jbHVkZSB0aW1lc3RhbXAgc28gdGhhdCB0aGluZ3MgZG9uJ3QgZ2V0IGNhY2hlZFxuICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmdldEpTT04oXG4gICAgICAgIGBiYWtlZF9xdWV1ZXMvJHtnbG9iYWxUaGlzLnVpZH0uanNvbj90PSR7RGF0ZS5ub3coKX1gLFxuICAgIClcbiAgICByZXR1cm4gcmVzdWx0XG59XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nX2RhdGEoZGF0YSk6IFByb21pc2U8YW55PiB7XG4gICAgaWYgKE1PQ0tNT0RFKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9nZ2VkIChtb2NrKVwiLCBkYXRhKVxuICAgICAgICByZXR1cm5cbiAgICB9XG4gICAgXG4gICAgZGF0YVtcInVybF9kYXRhXCJdID0gZ2xvYmFsVGhpcy51cmxfZGF0YVxuICAgIGNvbnNvbGUubG9nKFwiRGF0YVwiKVxuICAgIGlmICghKFwic3R1ZHlfaWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wic3R1ZHlfaWRcIl0gPSBcInRyaWFscnVuX3N0dWRpZXNcIlxuICAgIH1cbiAgICBkYXRhW1widXJsX2RhdGFcIl1bXCJxdWV1ZV9pZFwiXSA9IGdsb2JhbFRoaXMudWlkXG4gICAgY29uc29sZS5sb2coXCJsb2dnZWRcIiwgZGF0YSlcbiAgICBjb25zb2xlLmxvZyhcIkxvZ2dpbmcgdG9cIiwgU0VSVkVSX0xPR19ST09UICsgXCJsb2dcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoXG4gICAgICAgICAgICBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogXCIyc3RlcC10cnVzdC1zdHVkeS9cIitkYXRhWyd1cmxfZGF0YSddWydzdHVkeV9pZCddLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6IGdsb2JhbFRoaXMudWlkLFxuICAgICAgICAgICAgICAgICAgICBwYXlsb2FkOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgIH1cbn0iLCJpbXBvcnQgeyBERVZNT0RFIH0gZnJvbSBcIi4vZ2xvYmFsc1wiXG5leHBvcnQgdmFyIFVJRDogc3RyaW5nXG5leHBvcnQgdmFyIE1PQ0tNT0RFOiBib29sZWFuID0gZmFsc2VcbmltcG9ydCB7IGxvYWRfZGF0YSwgbG9nX2RhdGEgfSBmcm9tICcuL2Nvbm5lY3RvcidcbmltcG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0gZnJvbSBcIi4vdXRpbHNcIlxuXG52YXIgZGF0YTogYW55W10gPSBbXVxubGV0IHF1ZXN0aW9uX2kgPSAtMVxubGV0IHF1ZXN0aW9uOiBhbnkgPSBudWxsXG5sZXQgaW5pdGlhbF91c2VyX2RlY2lzaW9uOiBudW1iZXIgPSAtMVxubGV0IGZpbmFsX3VzZXJfZGVjaXNpb246IG51bWJlciA9IC0xXG5sZXQgYmFsYW5jZSA9IDBcbmxldCB1c2VyX3RydXN0OiBudW1iZXJcbmxldCBiZXRfdmFsX3JhdGlvOiBudW1iZXIgPSAxXG5sZXQgdGltZV9xdWVzdGlvbl9zdGFydDogbnVtYmVyXG5sZXQgdGltZV9maW5hbF9kZWNpc2lvbl9zdGFydDogbnVtYmVyXG5sZXQgdGltZV90cnVzdF9kZWNpc2lvbl9zdGFydDogbnVtYmVyXG5sZXQgaW5zdHJ1Y3Rpb25faTogbnVtYmVyID0gMFxubGV0IGNvdW50X2V4aXRlZF9wYWdlOiBudW1iZXIgPSAwXG5cbmZ1bmN0aW9uIGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UpIHtcbiAgICBpZiAoIWNvbmRpdGlvbikge1xuICAgICAgICB0aHJvdyBtZXNzYWdlIHx8IFwiQXNzZXJ0aW9uIGZhaWxlZFwiO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbmV4dF9pbnN0cnVjdGlvbnMoaW5jcmVtZW50OiBudW1iZXIpIHtcbiAgICBpbnN0cnVjdGlvbl9pICs9IGluY3JlbWVudFxuXG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gMCkge1xuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfcHJldlwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgfVxuICAgIGlmIChpbnN0cnVjdGlvbl9pID49IDYpIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLnNob3coKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS52YWwoXCJTdGFydCBzdHVkeVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5oaWRlKClcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikudmFsKFwiTmV4dFwiKVxuICAgIH1cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSA3KSB7XG4gICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuc2hvdygpXG4gICAgICAgIG5leHRfcXVlc3Rpb24oKVxuICAgIH1cblxuICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmNoaWxkcmVuKFwiOm5vdChpbnB1dClcIikuZWFjaCgoXywgZWwpID0+IHtcbiAgICAgICAgJChlbCkuaGlkZSgpXG4gICAgfSlcbiAgICAkKGAjaW5zdHJ1Y3Rpb25zXyR7aW5zdHJ1Y3Rpb25faX1gKS5zaG93KClcbn1cbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoKzEpKVxuJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikub24oXCJjbGlja1wiLCAoKSA9PiBuZXh0X2luc3RydWN0aW9ucygtMSkpXG5cbiQoXCIjYnV0dG9uX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKHF1ZXN0aW9uX2kgIT0gLTEpIHtcbiAgICAgICAgbGV0IGxvZ2dlZF9kYXRhID0ge1xuICAgICAgICAgICAgXCJxdWVzdGlvbl9pXCI6IHF1ZXN0aW9uX2ksXG4gICAgICAgICAgICBcInVzZXJfYmFsYW5jZV9wb3N0X2ludGVyYWN0aW9uXCI6IGJhbGFuY2UsXG4gICAgICAgICAgICBcInVzZXJfdHJ1c3RfdmFsXCI6IHVzZXJfdHJ1c3QsXG4gICAgICAgICAgICBcImluaXRpYWxfdXNlcl9kZWNpc2lvblwiOiBpbml0aWFsX3VzZXJfZGVjaXNpb24sXG4gICAgICAgICAgICBcImZpbmFsX3VzZXJfZGVjaXNpb25cIjogZmluYWxfdXNlcl9kZWNpc2lvbixcbiAgICAgICAgfVxuXG4gICAgICAgIGxvZ2dlZF9kYXRhWyd0aW1lcyddID0ge1xuICAgICAgICAgICAgXCJpbml0aWFsX2RlY2lzaW9uXCI6IHRpbWVfZmluYWxfZGVjaXNpb25fc3RhcnQgLSB0aW1lX3F1ZXN0aW9uX3N0YXJ0LFxuICAgICAgICAgICAgXCJmaW5hbF9kZWNpc2lvblwiOiB0aW1lX3RydXN0X2RlY2lzaW9uX3N0YXJ0IC0gdGltZV9maW5hbF9kZWNpc2lvbl9zdGFydCxcbiAgICAgICAgICAgIFwidXNlcl90cnVzdFwiOiBEYXRlLm5vdygpIC0gdGltZV90cnVzdF9kZWNpc2lvbl9zdGFydCxcbiAgICAgICAgfVxuICAgICAgICBsb2dnZWRfZGF0YVsncXVlc3Rpb24nXSA9IHF1ZXN0aW9uXG4gICAgICAgIGxvZ2dlZF9kYXRhWydjb3VudF9leGl0ZWRfcGFnZSddID0gY291bnRfZXhpdGVkX3BhZ2VcbiAgICAgICAgbG9nX2RhdGEobG9nZ2VkX2RhdGEpXG4gICAgICAgIGNvdW50X2V4aXRlZF9wYWdlID0gMFxuICAgIH1cbiAgICBuZXh0X3F1ZXN0aW9uKClcbn0pO1xuXG4vLyQoJyNyYW5nZV92YWwnKS5vbignaW5wdXQgY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuLy8gICAgYmV0X3ZhbCA9ICgkKHRoaXMpLnZhbCgpISBhcyBudW1iZXIpIC8gNSAqIDAuMVxuLy8gICAgJChcIiNyYW5nZV90ZXh0XCIpLnRleHQoYElmIHlvdSBhcmUgcmlnaHQsIHlvdSBnZXQgJCR7KGJldF92YWwqYmV0X3ZhbF9yYXRpbykudG9GaXhlZCgyKX0uIElmIHlvdSBhcmUgd3JvbmcsIHlvdSBsb3NlICQkeyhiZXRfdmFsLzEuMCkudG9GaXhlZCgyKX0uYClcbi8vICAgICQoXCIjYnV0dG9uX3BsYWNlX2JldFwiKS5zaG93KClcbi8vfSk7XG5cbiQoJyNyYW5nZV92YWwnKS5vbignaW5wdXQgY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgIHVzZXJfdHJ1c3QgPSAoJCh0aGlzKS52YWwoKSEgYXMgbnVtYmVyKVxuICAgICQoXCIjcmFuZ2VfdGV4dFwiKS50ZXh0KGBBZnRlciB0aGlzIGludGVyYWN0aW9uLCB5b3VyIGN1cnJlbnQgdHJ1c3QgaW4gdGhlIEFJOiAke3VzZXJfdHJ1c3QgKiAxMH0gLyAxMDAuYClcbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLnNob3coKVxufSk7XG5cbmZ1bmN0aW9uIG1ha2VfaW5pdGlhbF91c2VyX2RlY2lzaW9uKG9wdGlvbikge1xuICAgIHRpbWVfZmluYWxfZGVjaXNpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgaW5pdGlhbF91c2VyX2RlY2lzaW9uID0gb3B0aW9uXG4gICAgYXNzZXJ0KG9wdGlvbiA9PSAxIHx8IG9wdGlvbiA9PSAyLCBcIkludmFsaWQgb3B0aW9uIVwiKVxuICAgIGlmIChvcHRpb24gPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl9pbml0aWFsX2RlY2lzaW9uX29wdGlvbjFcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbml0aWFsX2RlY2lzaW9uX29wdGlvbjJcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIiNidXR0b25faW5pdGlhbF9kZWNpc2lvbl9vcHRpb24xXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbml0aWFsX2RlY2lzaW9uX29wdGlvbjJcIikuYXR0cihcImFjdGl2ZWRlY2lzaW9uXCIsIFwidHJ1ZVwiKVxuICAgIH1cbiAgICAkKFwiI2FpX2Fzc2lzdGFuY2VfZGl2XCIpLnNob3coKVxuICAgICQoXCIjZmluYWxfdXNlcl9kZWNpc2lvbl9kaXZcIikuc2hvdygpXG4gICAgJChcIiNidXR0b25faW5pdGlhbF9kZWNpc2lvbl9vcHRpb24xXCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAkKFwiI2J1dHRvbl9pbml0aWFsX2RlY2lzaW9uX29wdGlvbjJcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgICQoXCIjYnV0dG9uX2ZpbmFsX2RlY2lzaW9uX29wdGlvbjFcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25fZmluYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxufVxuXG4kKFwiI2J1dHRvbl9pbml0aWFsX2RlY2lzaW9uX29wdGlvbjFcIikub24oXCJjbGlja1wiLCAoKSA9PiBtYWtlX2luaXRpYWxfdXNlcl9kZWNpc2lvbigxKSlcbiQoXCIjYnV0dG9uX2luaXRpYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5vbihcImNsaWNrXCIsICgpID0+IG1ha2VfaW5pdGlhbF91c2VyX2RlY2lzaW9uKDIpKVxuXG5mdW5jdGlvbiBtYWtlX2ZpbmFsX3VzZXJfZGVjaXNpb24ob3B0aW9uKSB7XG4gICAgdGltZV90cnVzdF9kZWNpc2lvbl9zdGFydCA9IERhdGUubm93KClcbiAgICBmaW5hbF91c2VyX2RlY2lzaW9uID0gb3B0aW9uXG4gICAgYXNzZXJ0KG9wdGlvbiA9PSAxIHx8IG9wdGlvbiA9PSAyLCBcIkludmFsaWQgb3B0aW9uIVwiKVxuICAgIGlmIChvcHRpb24gPT0gMSkge1xuICAgICAgICAkKFwiI2J1dHRvbl9maW5hbF9kZWNpc2lvbl9vcHRpb24xXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICAgICAgJChcIiNidXR0b25fZmluYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2J1dHRvbl9maW5hbF9kZWNpc2lvbl9vcHRpb24xXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICAgICAkKFwiI2J1dHRvbl9maW5hbF9kZWNpc2lvbl9vcHRpb24yXCIpLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChcIiNidXR0b25fZmluYWxfZGVjaXNpb25fb3B0aW9uMVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgJChcIiNidXR0b25fZmluYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG4gICAgc2hvd19yZXN1bHQoKVxufVxuXG4kKFwiI2J1dHRvbl9maW5hbF9kZWNpc2lvbl9vcHRpb24xXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbWFrZV9maW5hbF91c2VyX2RlY2lzaW9uKDEpKVxuJChcIiNidXR0b25fZmluYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5vbihcImNsaWNrXCIsICgpID0+IG1ha2VfZmluYWxfdXNlcl9kZWNpc2lvbigyKSlcblxuZnVuY3Rpb24gc2hvd19yZXN1bHQoKSB7XG5cbiAgICBsZXQgY29ycmVjdF9vcHRpb246IG51bWJlciA9IHF1ZXN0aW9uIVtcImNvcnJlY3Rfb3B0aW9uXCJdXG4gICAgbGV0IHVzZXJfaXNfY29ycmVjdDogYm9vbGVhbiA9IGNvcnJlY3Rfb3B0aW9uID09IGZpbmFsX3VzZXJfZGVjaXNpb25cblxuICAgIGxldCBhaV9pc19jb3JyZWN0OiBib29sZWFuID0gcXVlc3Rpb24hW1wiYWlfaXNfY29ycmVjdFwiXVxuICAgIGxldCBtZXNzYWdlID0gXCJDb3JyZWN0IGFuc3dlcjogPGI+T3B0aW9uIFwiICsgY29ycmVjdF9vcHRpb24gKyBcIjwvYj4uPGJyPlwiXG4gICAgaWYgKHVzZXJfaXNfY29ycmVjdCkge1xuICAgICAgICBtZXNzYWdlICs9IFwiWW91IHBpY2tlZCBPcHRpb24gXCIgKyBmaW5hbF91c2VyX2RlY2lzaW9uICsgXCIsIHdoaWNoIHdhcyA8c3BhbiBjbGFzcz0nY29sb3JfY29ycmVjdCc+PGI+Y29ycmVjdDwvYj48L3NwYW4+Ljxicj5cIlxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbWVzc2FnZSArPSBcIllvdSBwaWNrZWQgT3B0aW9uIFwiICsgZmluYWxfdXNlcl9kZWNpc2lvbiArIFwiLCB3aGljaCB3YXMgPHNwYW4gY2xhc3M9J2NvbG9yX2luY29ycmVjdCc+PGI+aW5jb3JyZWN0PC9iPjwvc3Bhbj4uPGJyPlwiXG4gICAgfVxuICAgIGlmIChhaV9pc19jb3JyZWN0KSB7XG4gICAgICAgIG1lc3NhZ2UgKz0gXCJUaGUgQUkgcGlja2VkIE9wdGlvbiBcIiArIGNvcnJlY3Rfb3B0aW9uICsgXCIsIHdoaWNoIHdhcyA8c3BhbiBjbGFzcz0nY29sb3JfY29ycmVjdCc+PGI+Y29ycmVjdDxiPjwvc3Bhbj4uPGJyPlwiXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBtZXNzYWdlICs9IFwiVGhlIEFJIHBpY2tlZCBPcHRpb24gXCIgKyBjb3JyZWN0X29wdGlvbiArIFwiLCB3aGljaCB3YXMgPHNwYW4gY2xhc3M9J2NvbG9yX2luY29ycmVjdCc+PGI+aW5jb3JyZWN0PC9iPjwvc3Bhbj4uPGJyPlwiXG4gICAgfVxuICAgIGlmICh1c2VyX2lzX2NvcnJlY3QpIHtcbiAgICAgICAgbWVzc2FnZSArPSBcIjxzcGFuIGNsYXNzPSdjb2xvcl9jb3JyZWN0Jz48Yj5Zb3UgcmVjZWl2ZSBhIHJld2FyZCBvZiAkMC4xLjwvYj48L3NwYW4+XCJcbiAgICAgICAgYmFsYW5jZSArPSAwLjFcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG1lc3NhZ2UgKz0gXCI8c3BhbiBjbGFzcz0nY29sb3JfaW5jb3JyZWN0Jz48Yj5Zb3UgZG8gbm90IHJlY2VpdmUgYW55IHJld2FyZC48L2I+PC9zcGFuPlwiXG4gICAgfVxuXG4gICAgbWVzc2FnZSArPSBcIjxicj5cIlxuICAgIC8vaWYgKHN1Y2Nlc3MpIHtcbiAgICAvLyAgICBtZXNzYWdlICs9IGBZb3UgZ2FpbiAkJHsoYmV0X3ZhbCpiZXRfdmFsX3JhdGlvKS50b0ZpeGVkKDIpfS5gXG4gICAgLy8gICAgYmFsYW5jZSArPSBiZXRfdmFsKmJldF92YWxfcmF0aW9cbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgbWVzc2FnZSArPSBgWW91IGxvc2UgJCR7KGJldF92YWwvMS4wKS50b0ZpeGVkKDIpfS5gXG4gICAgLy8gICAgYmFsYW5jZSAtPSBiZXRfdmFsLzEuMFxuICAgIC8vICAgIGJhbGFuY2UgPSBNYXRoLm1heCgwLCBiYWxhbmNlKVxuICAgIC8vfVxuICAgICQoXCIjYmFsYW5jZVwiKS50ZXh0KGBCYWxhbmNlOiAkJHtiYWxhbmNlLnRvRml4ZWQoMil9ICsgJDEuMGApXG4gICAgJChcIiNyZXN1bHRfc3BhblwiKS5odG1sKG1lc3NhZ2UpXG4gICAgLy8kKFwiI2J1dHRvbl9uZXh0XCIpLnNob3coKVxuICAgICQoXCIjcmVzdWx0X3NwYW5cIikuc2hvdygpXG4gICAgLy8kKFwiI2J1dHRvbl9wbGFjZV9iZXRcIikuaGlkZSgpXG4gICAgJChcIiNob3dfY29uZmlkZW50X2RpdlwiKS5zaG93KClcblxuICAgIC8vJCgnI3JhbmdlX3ZhbCcpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbn1cblxuLy8kKFwiI2J1dHRvbl9wbGFjZV9iZXRcIikub24oXCJjbGlja1wiLCBzaG93X3Jlc3VsdClcblxuZnVuY3Rpb24gbmV4dF9xdWVzdGlvbigpIHtcbiAgICAvLyByZXN0b3JlIHByZXZpb3VzIHN0YXRlIG9mIFVJXG4gICAgJChcIiNidXR0b25faW5pdGlhbF9kZWNpc2lvbl9vcHRpb24xXCIpLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICQoXCIjYnV0dG9uX2luaXRpYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9pbml0aWFsX2RlY2lzaW9uX29wdGlvbjFcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNidXR0b25faW5pdGlhbF9kZWNpc2lvbl9vcHRpb24yXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX2ZpbmFsX2RlY2lzaW9uX29wdGlvbjFcIikucmVtb3ZlQXR0cihcImFjdGl2ZWRlY2lzaW9uXCIpXG4gICAgJChcIiNidXR0b25fZmluYWxfZGVjaXNpb25fb3B0aW9uMlwiKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAkKFwiI2J1dHRvbl9maW5hbF9kZWNpc2lvbl9vcHRpb24xXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgICQoXCIjYnV0dG9uX2ZpbmFsX2RlY2lzaW9uX29wdGlvbjJcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgJChcIiNhaV9hc3Npc3RhbmNlX2RpdlwiKS5oaWRlKClcbiAgICAkKFwiI2ZpbmFsX3VzZXJfZGVjaXNpb25fZGl2XCIpLmhpZGUoKVxuICAgICQoJyNyYW5nZV92YWwnKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICAkKFwiI2hvd19jb25maWRlbnRfZGl2XCIpLmhpZGUoKVxuICAgICQoXCIjYnV0dG9uX3BsYWNlX2JldFwiKS5oaWRlKClcbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLmhpZGUoKVxuICAgICQoXCIjcmVzdWx0X3NwYW5cIikuaGlkZSgpXG4gICAgaWYgKHF1ZXN0aW9uX2kgPT0gLTEpIHtcbiAgICAgICAgJChcIiNyYW5nZV90ZXh0XCIpLnRleHQoXCItXCIpXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAkKFwiI3JhbmdlX3RleHRcIikudGV4dChgQmVmb3JlIHRoaXMgaW50ZXJhY3Rpb24sIHlvdXIgdHJ1c3QgaW4gdGhlIEFJOiAke3VzZXJfdHJ1c3QgKiAxMH0gLyAxMDAuYClcbiAgICB9XG4gICAgJChcIiNyYW5nZV92YWxcIikudmFsKHVzZXJfdHJ1c3QpXG5cbiAgICBxdWVzdGlvbl9pICs9IDFcbiAgICBpZiAocXVlc3Rpb25faSA+PSBkYXRhLmxlbmd0aCkge1xuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuaGlkZSgpXG4gICAgICAgIGlmIChNT0NLTU9ERSkge1xuICAgICAgICAgICAgJChcIiNtYWluX2JveF9lbmRfbW9ja1wiKS5zaG93KClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICQoXCIjbWFpbl9ib3hfZW5kXCIpLnNob3coKVxuICAgICAgICB9XG4gICAgICAgIHJldHVyblxuICAgIH1cbiAgICBxdWVzdGlvbiA9IGRhdGFbcXVlc3Rpb25faV1cblxuICAgICQoXCIjcXVlc3Rpb25fc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcInF1ZXN0aW9uXCJdKVxuICAgICQoXCIjb3B0aW9uMV9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wib3B0aW9uMVwiXSlcbiAgICAkKFwiI29wdGlvbjJfc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcIm9wdGlvbjJcIl0pXG4gICAgJChcIiNhaV9wcmVkaWN0aW9uX3NwYW5cIikuaHRtbChcIk9wdGlvbiBcIiArIHF1ZXN0aW9uIVtcImFpX3ByZWRpY3Rpb25cIl0pXG4gICAgJChcIiNhaV9jb25maWRlbmNlX3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJhaV9jb25maWRlbmNlXCJdKVxuXG4gICAgLy8gc2V0IGJldCB2YWx1ZSByYXRpb1xuICAgIGlmKHF1ZXN0aW9uLmhhc093blByb3BlcnR5KFwicmV3YXJkX3JhdGlvXCIpKSB7XG4gICAgICAgIGxldCBbcmF0aW8xLCByYXRpbzJdID0gcXVlc3Rpb25bXCJyZXdhcmRfcmF0aW9cIl1cbiAgICAgICAgcmF0aW8xID0gTnVtYmVyKHJhdGlvMSlcbiAgICAgICAgcmF0aW8yID0gTnVtYmVyKHJhdGlvMilcbiAgICAgICAgYmV0X3ZhbF9yYXRpbyA9IHJhdGlvMS9yYXRpbzJcbiAgICB9IGVsc2Uge1xuICAgICAgICBiZXRfdmFsX3JhdGlvID0gMVxuICAgIH1cblxuICAgIHRpbWVfcXVlc3Rpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgJChcIiNwcm9ncmVzc1wiKS50ZXh0KGBQcm9ncmVzczogJHtxdWVzdGlvbl9pICsgMX0gLyAke2RhdGEubGVuZ3RofWApXG59XG5cbi8vIGdldCB1c2VyIGlkIGFuZCBsb2FkIHF1ZXVlXG4vLyB0cnkgdG8gc2VlIGlmIHN0YXJ0IG92ZXJyaWRlIHdhcyBwYXNzZWRcbmNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG5jb25zdCBzdGFydE92ZXJyaWRlID0gdXJsUGFyYW1zLmdldCgnc3RhcnQnKTtcbmNvbnN0IFVJREZyb21VUkwgPSB1cmxQYXJhbXMuZ2V0KFwidWlkXCIpXG5nbG9iYWxUaGlzLnVybF9kYXRhID0gcGFyYW1zVG9PYmplY3QodXJsUGFyYW1zLmVudHJpZXMoKSlcblxuaWYgKFVJREZyb21VUkwgIT0gbnVsbCkge1xuICAgIGdsb2JhbFRoaXMudWlkID0gVUlERnJvbVVSTCBhcyBzdHJpbmdcbiAgICBpZiAoZ2xvYmFsVGhpcy51aWQgPT0gXCJwcm9saWZpY19yYW5kb21cIikge1xuICAgICAgICBsZXQgcXVldWVfaWQgPSBgJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCl9YC5wYWRTdGFydCgzLCBcIjBcIilcbiAgICAgICAgZ2xvYmFsVGhpcy51aWQgPSBgJHt1cmxQYXJhbXMuZ2V0KFwicHJvbGlmaWNfcXVldWVfbmFtZVwiKX1fJHtxdWV1ZV9pZH1gXG4gICAgfVxufSBlbHNlIGlmIChERVZNT0RFKSB7XG4gICAgZ2xvYmFsVGhpcy51aWQgPSBcImRlbW9cIlxufSBlbHNlIHtcbiAgICBsZXQgVUlEX21heWJlOiBhbnkgPSBudWxsXG4gICAgd2hpbGUgKFVJRF9tYXliZSA9PSBudWxsKSB7XG4gICAgICAgIFVJRF9tYXliZSA9IHByb21wdChcIkVudGVyIHlvdXIgdXNlciBpZC4gUGxlYXNlIGdldCBpbiB0b3VjaCBpZiB5b3Ugd2VyZSBub3QgYXNzaWduZWQgYW4gaWQgYnV0IHdpc2ggdG8gcGFydGljaXBhdGUgaW4gdGhpcyBleHBlcmltZW50LlwiKVxuICAgIH1cbiAgICBnbG9iYWxUaGlzLnVpZCA9IFVJRF9tYXliZSFcbn1cblxuLy8gdmVyc2lvbiBmb3IgcGFwZXJcbmlmIChnbG9iYWxUaGlzLnVpZC5zdGFydHNXaXRoKFwiZGVtb19wYXBlclwiKSkge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufSBlbHNlIHtcblxufVxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggVUlEXCIsIGdsb2JhbFRoaXMudWlkKVxubG9hZF9kYXRhKCkuY2F0Y2goKF9lcnJvcikgPT4ge1xuICAgIC8vYWxlcnQoXCJJbnZhbGlkIHVzZXIgaWQuXCIpXG4gICAgY29uc29sZS5sb2coXCJJbnZhbGlkIHVzZXIgaWQuXCIpXG4gICAgY29uc29sZS5sb2coZ2xvYmFsVGhpcy51aWQhKVxuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKVxufVxuKS50aGVuKChuZXdfZGF0YSkgPT4ge1xuICAgIGRhdGEgPSBuZXdfZGF0YVxuICAgIGlmIChzdGFydE92ZXJyaWRlICE9IG51bGwpIHtcbiAgICAgICAgcXVlc3Rpb25faSA9IHBhcnNlSW50KHN0YXJ0T3ZlcnJpZGUpIC0gMVxuICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXJ0aW5nIGZyb21cIiwgcXVlc3Rpb25faSlcbiAgICB9XG4gICAgLy8gbmV4dF9xdWVzdGlvbigpXG4gICAgbmV4dF9pbnN0cnVjdGlvbnMoMClcbiAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5zaG93KClcbiAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG59KVxuXG5jb25zb2xlLmxvZyhcIlN0YXJ0aW5nIHNlc3Npb24gd2l0aCBVSUQ6XCIsIGdsb2JhbFRoaXMudWlkISlcblxubGV0IGFsZXJ0X2FjdGl2ZSA9IGZhbHNlXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKCFhbGVydF9hY3RpdmUpIHtcbiAgICAgICAgY291bnRfZXhpdGVkX3BhZ2UgKz0gMVxuICAgICAgICBhbGVydF9hY3RpdmUgPSB0cnVlXG4gICAgICAgIGFsZXJ0KFwiUGxlYXNlIGRvbid0IGxlYXZlIHRoZSBwYWdlLiBJZiB5b3UgZG8gc28gYWdhaW4sIHdlIG1heSByZXN0cmljdCBwYXlpbmcgeW91LlwiKVxuICAgICAgICBhbGVydF9hY3RpdmUgPSBmYWxzZVxuICAgIH1cbn0iLCJmdW5jdGlvbiBwYXJhbXNUb09iamVjdChlbnRyaWVzKSB7XG4gIGNvbnN0IHJlc3VsdCA9IHt9XG4gIC8vIGVhY2ggJ2VudHJ5JyBpcyBhIFtrZXksIHZhbHVlXSB0dXBwbGVcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZW50cmllcykge1xuICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgcGFyYW1zVG9PYmplY3QgfSJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlNFUlZFUl9MT0dfUk9PVCIsIk1PQ0tNT0RFIiwiZGF0YSIsInVzZXJfdHJ1c3QiLCJ0aW1lX3F1ZXN0aW9uX3N0YXJ0IiwidGltZV9maW5hbF9kZWNpc2lvbl9zdGFydCIsInRpbWVfdHJ1c3RfZGVjaXNpb25fc3RhcnQiLCJxdWVzdGlvbl9pIiwicXVlc3Rpb24iLCJpbml0aWFsX3VzZXJfZGVjaXNpb24iLCJmaW5hbF91c2VyX2RlY2lzaW9uIiwiYmFsYW5jZSIsImJldF92YWxfcmF0aW8iLCJpbnN0cnVjdGlvbl9pIiwiY291bnRfZXhpdGVkX3BhZ2UiLCJhc3NlcnQiLCJjb25kaXRpb24iLCJtZXNzYWdlIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCIkIiwiYXR0ciIsInJlbW92ZUF0dHIiLCJzaG93IiwidmFsIiwiaGlkZSIsIm5leHRfcXVlc3Rpb24iLCJjaGlsZHJlbiIsImVhY2giLCJfIiwiZWwiLCJtYWtlX2luaXRpYWxfdXNlcl9kZWNpc2lvbiIsIm9wdGlvbiIsIkRhdGUiLCJub3ciLCJtYWtlX2ZpbmFsX3VzZXJfZGVjaXNpb24iLCJjb3JyZWN0X29wdGlvbiIsInVzZXJfaXNfY29ycmVjdCIsImFpX2lzX2NvcnJlY3QiLCJ0ZXh0IiwidG9GaXhlZCIsImh0bWwiLCJzaG93X3Jlc3VsdCIsImxlbmd0aCIsInJhdGlvMSIsInJhdGlvMiIsIk51bWJlciIsIm9uIiwibG9nZ2VkX2RhdGEiLCJhc3luYyIsImNvbnNvbGUiLCJsb2ciLCJnbG9iYWxUaGlzIiwidXJsX2RhdGEiLCJ1aWQiLCJhamF4IiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2plY3QiLCJwYXlsb2FkIiwidHlwZSIsImNvbnRlbnRUeXBlIiwiZSIsImxvZ19kYXRhIiwidGhpcyIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3RhcnRPdmVycmlkZSIsIlVJREZyb21VUkwiLCJlbnRyaWVzIiwicmVzdWx0IiwidmFsdWUiLCJwYXJhbXNUb09iamVjdCIsInF1ZXVlX2lkIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicGFkU3RhcnQiLCJVSURfbWF5YmUiLCJwcm9tcHQiLCJzdGFydHNXaXRoIiwiZ2V0SlNPTiIsImxvYWRfZGF0YSIsImNhdGNoIiwiX2Vycm9yIiwicmVsb2FkIiwidGhlbiIsIm5ld19kYXRhIiwicGFyc2VJbnQiLCJhbGVydF9hY3RpdmUiLCJkb2N1bWVudCIsIm9udmlzaWJpbGl0eWNoYW5nZSIsImFsZXJ0Il0sInNvdXJjZVJvb3QiOiIifQ==